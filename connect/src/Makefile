R$(MC_LIB)EMOVE=/bin/rm -f
MOVE=/bin/mv
LINK=ln -s
MAKE=/usr/bin/make
BIN_DIR=../../bin
LIB_DIR=../../lib
THIRD_PARTY_DIR=../../thirdparty
UTIL_DIR=../../util/src/
UTIL_LIB=$(LIB_DIR)/libutil.a
OS=OSX

CC=g++
CFLAGS=-c -Wall -Os
INCFLAGS=-I . -I $(UTIL_DIR)
LDFLAGS=-L $(LIB_DIR) -l util
ARCHIVE=/usr/bin/ar r

print-%  : ; @echo $* = $($*)

%.o: %.c %.h Makefile


.cpp.o: $(COMMON_HEADERS) Makefile
	$(CC) $(ZMQ_INCFLAGS) $(CFLAGS) $< -o $@

################################################################################
#
# ZMQ
#
################################################################################

ZMQ_COMMON_HEADERS=connect_util.h zmq_version.h $(UTIL_DIR)/am_constants.h $(UTIL_DIR)/am_split_string.h $(UTIL_DIR)/am_util.h

ZMQ_SOURCES=connect_util.cpp zmq_read.cpp zmq_write.cpp zmq_hub_class.cpp
ZMQ_OBJECTS=$(ZMQ_SOURCES:.cpp=.o)
ZMQ_HEADERS=$(ZMQ_SOURCES:.cpp=.h)

ZMQ_LIB_ROOT=amzmq
ZMQ_LIB=lib$(ZMQ_LIB_ROOT).a
ZMQ_LIB_TARGET=$(LIB_DIR)/$(ZMQ_LIB)

ZMQ_INCFLAGS=$(INCFLAGS) -I $(THIRD_PARTY_DIR)/include/zmq
ZMQ_LDFLAGS=$(LDFLAGS) -L $(THIRD_PARTY_DIR)/$(OS)/lib -l zmq
ZMQ_EXE_LDFLAGS=$(ZMQ_LDFLAGS) -l $(ZMQ_LIB_ROOT)

ZMQ_EXECUTABLE_01=stdin2zmq
ZMQ_MAIN_01=stdin_2_zmq.cpp
ZMQ_SOURCES_01=$(ZMQ_MAIN_01)
ZMQ_OBJECTS_01=$(ZMQ_MAIN_01:.cpp=.o)
ZMQ_EXECUTABLE_TARGET_01=$(BIN_DIR)/$(ZMQ_EXECUTABLE_01)

ZMQ_EXECUTABLE_02=zmq2stdout
ZMQ_MAIN_02=zmq_2_stdout.cpp
ZMQ_SOURCES_02=$(ZMQ_MAIN_02)
ZMQ_OBJECTS_02=$(ZMQ_MAIN_02:.cpp=.o)
ZMQ_EXECUTABLE_TARGET_02=$(BIN_DIR)/$(ZMQ_EXECUTABLE_02)

ZMQ_EXECUTABLE_03=file2zmq
ZMQ_MAIN_03=file_2_zmq.cpp
ZMQ_SOURCES_03=$(ZMQ_MAIN_03)
ZMQ_OBJECTS_03=$(ZMQ_MAIN_03:.cpp=.o)
ZMQ_EXECUTABLE_TARGET_03=$(BIN_DIR)/$(ZMQ_EXECUTABLE_03)

ZMQ_EXECUTABLE_04=zmq2file
ZMQ_MAIN_04=zmq_2_file.cpp
ZMQ_SOURCES_04=$(ZMQ_MAIN_04)
ZMQ_OBJECTS_04=$(ZMQ_MAIN_04:.cpp=.o)
ZMQ_EXECUTABLE_TARGET_04=$(BIN_DIR)/$(ZMQ_EXECUTABLE_04)

ZMQ_EXECUTABLE_05=zmqhub
ZMQ_MAIN_05=zmq_hub.cpp
ZMQ_SOURCES_05=$(ZMQ_MAIN_05)
ZMQ_OBJECTS_05=$(ZMQ_MAIN_05:.cpp=.o)
ZMQ_EXECUTABLE_TARGET_05=$(BIN_DIR)/$(ZMQ_EXECUTABLE_05)


ZMQ_EXECUTABLES=$(ZMQ_EXECUTABLE_01) $(ZMQ_EXECUTABLE_02) $(ZMQ_EXECUTABLE_03) $(ZMQ_EXECUTABLE_04) $(ZMQ_EXECUTABLE_05)
ZMQ_ALL_OBJECTS=$(ZMQ_OBJECTS) $(ZMQ_OBJECTS_01) $(ZMQ_OBJECTS_02) $(ZMQ_OBJECTS_03) $(ZMQ_OBJECTS_04) $(ZMQ_OBJECTS_05)


################################################################################
#
# Multicast
#
################################################################################

MC_COMMON_HEADERS=connect_util.h mc_version.h $(UTIL_DIR)/am_constants.h $(UTIL_DIR)/am_split_string.h $(UTIL_DIR)/am_util.h

MC_SOURCES=connect_util.cpp am_multicast_read.cpp am_multicast_write.cpp
MC_OBJECTS=$(MC_SOURCES:.cpp=.o)
MC_HEADERS=$(MC_SOURCES:.cpp=.h)

MC_LIB_ROOT=ammc
MC_LIB=lib$(MC_LIB_ROOT).a
MC_LIB_TARGET=$(LIB_DIR)/$(MC_LIB)

MC_INCFLAGS=$(INCFLAGS)
MC_LDFLAGS=$(LDFLAGS)
MC_EXE_LDFLAGS=$(MC_LDFLAGS) -l $(MC_LIB_ROOT)

MC_EXECUTABLE_01=stdin2mc
MC_MAIN_01=stdin_2_mc.cpp
MC_SOURCES_01=$(MC_MAIN_01)
MC_OBJECTS_01=$(MC_MAIN_01:.cpp=.o)
MC_EXECUTABLE_TARGET_01=$(BIN_DIR)/$(MC_EXECUTABLE_01)

#MC_EXECUTABLE_02=mc2stdout
#MC_MAIN_02=mc_2_stdout.cpp
#MC_SOURCES_02=$(MC_MAIN_02)
#MC_OBJECTS_02=$(MC_MAIN_02:.cpp=.o)
#MC_EXECUTABLE_TARGET_02=$(BIN_DIR)/$(MC_EXECUTABLE_02)

#MC_EXECUTABLE_03=file2mc
#MC_MAIN_03=file_2_mc.cpp
#MC_SOURCES_03=$(MC_MAIN_03)
#MC_OBJECTS_03=$(MC_MAIN_03:.cpp=.o)
#MC_EXECUTABLE_TARGET_03=$(BIN_DIR)/$(MC_EXECUTABLE_03)

#MC_EXECUTABLE_04=mc2file
#MC_MAIN_04=mc_2_file.cpp
#MC_SOURCES_04=$(MC_MAIN_04)
#MC_OBJECTS_04=$(MC_MAIN_04:.cpp=.o)
#MC_EXECUTABLE_TARGET_04=$(BIN_DIR)/$(MC_EXECUTABLE_04)


MC_EXECUTABLES=$(MC_EXECUTABLE_01) $(MC_EXECUTABLE_02) $(MC_EXECUTABLE_03) $(MC_EXECUTABLE_04)
MC_ALL_OBJECTS=$(MC_OBJECTS) $(MC_OBJECTS_01) $(MC_OBJECTS_02) $(MC_OBJECTS_03) $(MC_OBJECTS_04)



################################################################################
#
# ALL
#
################################################################################




all: Makefile $(ZMQ_LIB_TARGET) $(ZMQ_EXECUTABLE_TARGET_01) $(ZMQ_EXECUTABLE_TARGET_02) $(ZMQ_EXECUTABLE_TARGET_03) $(ZMQ_EXECUTABLE_TARGET_04) $(ZMQ_EXECUTABLE_TARGET_05) $(MC_LIB_TARGET) $(MC_EXECUTABLE_TARGET_01) $(MC_EXECUTABLE_TARGET_02) $(MC_EXECUTABLE_TARGET_03) $(MC_EXECUTABLE_TARGET_04)

clean:
	make mc_clean
	make zmq_clean

clean_all:
	make mc_clean_all
	make zmq_clean_all

rebuild:
	make mc_rebuild
	make zmq_rebuild

install:
	make mc_install
	make zmq_install

install_clean:
	make mc_install_clean
	make zmq_install_clean






################################################################################
#
# ZMQ
#
################################################################################


zmq: $(ZMQ_LIB_TARGET) $(ZMQ_EXECUTABLE_TARGET_01) $(ZMQ_EXECUTABLE_TARGET_02) $(ZMQ_EXECUTABLE_TARGET_03) $(ZMQ_EXECUTABLE_TARGET_04) $(ZMQ_EXECUTABLE_TARGET_05)

$(ZMQ_LIB_TARGET): Makefile $(ZMQ_OBJECTS);
	$(ARCHIVE) $(ZMQ_LIB) $(ZMQ_OBJECTS); $(MOVE) $(ZMQ_LIB) $(LIB_DIR);

$(ZMQ_EXECUTABLE_TARGET_01): $(ZMQ_MAIN_01) $(ZMQ_SOURCES) $(ZMQ_ALL_OBJECTS_01) $(ZMQ_HEADERS_01) $(ZMQ_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(ZMQ_INCFLAGS) $(CFLAGS) $(ZMQ_MAIN_01)
	$(CC) $(ZMQ_INCFLAGS) $(ZMQ_ALL_OBJECTS_01) $(ZMQ_EXE_LDFLAGS) $(ZMQ_OBJECTS_01) -o $@


$(ZMQ_EXECUTABLE_TARGET_02): $(ZMQ_MAIN_02) $(ZMQ_SOURCES) $(ZMQ_ALL_OBJECTS_02) $(ZMQ_HEADERS_02) $(ZMQ_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(ZMQ_INCFLAGS) $(CFLAGS) $(ZMQ_MAIN_02)
	$(CC) $(ZMQ_INCFLAGS) $(ZMQ_ALL_OBJECTS_02) $(ZMQ_EXE_LDFLAGS) $(ZMQ_OBJECTS_02) -o $@


$(ZMQ_EXECUTABLE_TARGET_03): $(ZMQ_MAIN_03) $(ZMQ_SOURCES) $(ZMQ_ALL_OBJECTS_03) $(ZMQ_HEADERS_03) $(ZMQ_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(ZMQ_INCFLAGS) $(CFLAGS) $(ZMQ_MAIN_03)
	$(CC) $(ZMQ_INCFLAGS) $(ZMQ_ALL_OBJECTS_03) $(ZMQ_EXE_LDFLAGS) $(ZMQ_OBJECTS_03) -o $@


$(ZMQ_EXECUTABLE_TARGET_04): $(ZMQ_MAIN_04) $(ZMQ_SOURCES) $(ZMQ_ALL_OBJECTS_04) $(ZMQ_HEADERS_04) $(ZMQ_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(ZMQ_INCFLAGS) $(CFLAGS) $(ZMQ_MAIN_04)
	$(CC) $(ZMQ_INCFLAGS) $(ZMQ_ALL_OBJECTS_04) $(ZMQ_EXE_LDFLAGS) $(ZMQ_OBJECTS_04) -o $@


$(ZMQ_EXECUTABLE_TARGET_05): $(ZMQ_MAIN_05) $(ZMQ_SOURCES) $(ZMQ_ALL_OBJECTS_05) $(ZMQ_HEADERS_05) $(ZMQ_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(ZMQ_INCFLAGS) $(CFLAGS) $(ZMQ_MAIN_05)
	$(CC) $(ZMQ_INCFLAGS) $(ZMQ_ALL_OBJECTS_05) $(ZMQ_EXE_LDFLAGS) $(ZMQ_OBJECTS_05) -o $@


zmq_clean:
	$(REMOVE) $(ZMQ_ALL_OBJECTS)

zmq_clean_all: Makefile $(ZMQ_LIB_TARGET) $(ZMQ_EXECUTABLE_TARGET_TARGET_01) $(ZMQ_EXECUTABLE_TARGET_TARGET_02) $(ZMQ_EXECUTABLE_TARGET_TARGET_03) $(ZMQ_EXECUTABLE_TARGET_TARGET_04) $(ZMQ_EXECUTABLE_TARGET_TARGET_05)
	make zmq_clean
	$(REMOVE) $(LIB_DIR)/$(ZMQ_LIB)

zmq_rebuild: Makefile $(ZMQ_LIB_TARGET) $(ZMQ_EXECUTABLE_TARGET_TARGET_01) $(ZMQ_EXECUTABLE_TARGET_TARGET_02) $(ZMQ_EXECUTABLE_TARGET_TARGET_03) $(ZMQ_EXECUTABLE_TARGET_TARGET_04) $(ZMQ_EXECUTABLE_TARGET_TARGET_05)
	make zmq_clean_all; make zmq

zmq_install: Makefile $(ZMQ_LIB_TARGET) $(ZMQ_EXECUTABLE_TARGET_TARGET_01) $(ZMQ_EXECUTABLE_TARGET_TARGET_02) $(ZMQ_EXECUTABLE_TARGET_TARGET_03) $(ZMQ_EXECUTABLE_TARGET_TARGET_04) $(ZMQ_EXECUTABLE_TARGET_TARGET_05)
	$(MOVE) $(ZMQ_LIB) $(LIB_DIR); \


zmq_install_clean: Makefile $(ZMQ_LIB_TARGET) $(ZMQ_EXECUTABLE_TARGET_01) $(ZMQ_EXECUTABLE_TARGET_02) $(ZMQ_EXECUTABLE_TARGET_03) $(ZMQ_EXECUTABLE_TARGET_04) $(ZMQ_EXECUTABLE_TARGET_05)
	make zmq_install
	make zmq_clean


################################################################################
#
# Multicast
#
################################################################################

mc: $(MC_LIB_TARGET) $(MC_EXECUTABLE_01) $(MC_EXECUTABLE_02) $(MC_EXECUTABLE_03) $(MC_EXECUTABLE_04)


$(MC_LIB_TARGET): Makefile $(MC_OBJECTS);
	$(ARCHIVE) $(MC_LIB) $(MC_OBJECTS); $(MOVE) $(MC_LIB) $(LIB_DIR);


$(MC_EXECUTABLE_TARGET_01): $(MC_MAIN_01) $(MC_SOURCES) $(MC_ALL_OBJECTS_01) $(MC_HEADERS_01) $(MC_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(MC_INCFLAGS) $(CFLAGS) $(MC_MAIN_01)
	$(CC) $(MC_INCFLAGS) $(MC_ALL_OBJECTS_01) $(MC_EXE_LDFLAGS) $(MC_OBJECTS_01) -o $@


$(MC_EXECUTABLE_TARGET_02): $(MC_MAIN_02) $(MC_SOURCES) $(MC_ALL_OBJECTS_02) $(MC_HEADERS_02) $(MC_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(MC_INCFLAGS) $(CFLAGS) $(MC_MAIN_02)
	$(CC) $(MC_INCFLAGS) $(MC_ALL_OBJECTS_02) $(MC_EXE_LDFLAGS) $(MC_OBJECTS_02) -o $@


$(MC_EXECUTABLE_TARGET_03): $(MC_MAIN_03) $(MC_SOURCES) $(MC_ALL_OBJECTS_03) $(MC_HEADERS_03) $(MC_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(MC_INCFLAGS) $(CFLAGS) $(MC_MAIN_03)
	$(CC) $(MC_INCFLAGS) $(MC_ALL_OBJECTS_03) $(MC_EXE_LDFLAGS) $(MC_OBJECTS_03) -o $@


$(MC_EXECUTABLE_TARGET_04): $(MC_MAIN_04) $(MC_SOURCES) $(MC_ALL_OBJECTS_04) $(MC_HEADERS_04) $(MC_COMMON_HEADERS) $(UTIL_LIB) Makefile
	$(CC) $(MC_INCFLAGS) $(CFLAGS) $(MC_MAIN_04)
	$(CC) $(MC_INCFLAGS) $(MC_ALL_OBJECTS_04) $(MC_EXE_LDFLAGS) $(MC_OBJECTS_04) -o $@



mc_clean:
	$(REMOVE) $(MC_ALL_OBJECTS)

mc_clean_all:Makefile $(MC_LIB_TARGET) $(MC_EXECUTABLE_TARGET_01) $(MC_EXECUTABLE_TARGET_02) $(MC_EXECUTABLE_TARGET_03) $(MC_EXECUTABLE_TARGET_04)
	make mc_clean
	$(REMOVE) $(LIB_DIR)/$(MC_LIB)

mc_rebuild:Makefile $(MC_LIB_TARGET) $(MC_EXECUTABLE_TARGET_01) $(MC_EXECUTABLE_TARGET_02) $(MC_EXECUTABLE_TARGET_03) $(MC_EXECUTABLE_TARGET_04)
	make mc_clean_all; make mc

mc_install: Makefile $(MC_LIB_TARGET) $(MC_EXECUTABLE_TARGET_01) $(MC_EXECUTABLE_TARGET_02) $(MC_EXECUTABLE_TARGET_03) $(MC_EXECUTABLE_TARGET_04)
	$(MOVE) $(MC_LIB) $(LIB_DIR); \
	$(MOVE) $(MC_EXECUTABLE_01) $(BIN_DIR); \
	$(MOVE) $(MC_EXECUTABLE_02) $(BIN_DIR); \
	$(MOVE) $(MC_EXECUTABLE_03) $(BIN_DIR); \
	$(MOVE) $(MC_EXECUTABLE_04) $(BIN_DIR); \


mc_install_clean: Makefile $(MC_LIB_TARGET) $(MC_EXECUTABLE_TARGET_01) $(MC_EXECUTABLE_TARGET_02) $(MC_EXECUTABLE_TARGET_03) $(MC_EXECUTABLE_TARGET_04)
	make mc_install
	make mc_clean






################################################################################
#
# ALL
#
################################################################################

SOURCES=$(MC_SOURCES) $(ZMQ_SOURCES)
OBJECTS=$(MC_OBJECTS) $(ZMQ_OBJECTS)
HEADERS=$(MC_HEADERS) $(ZMQ_HEADERS)

